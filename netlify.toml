# ==============================================================================
# Configuration Netlify pour Next.js - Gestion Locative
# https://docs.netlify.com/integrations/frameworks/next-js/overview/
# ==============================================================================

[build]
  command = "npm run build"
  # Ne pas spÃ©cifier publish - le plugin Next.js le gÃ¨re automatiquement

# Plugin Next.js pour Netlify (requis)
[[plugins]]
  package = "@netlify/plugin-nextjs"

# Variables d'environnement de build
[build.environment]
  NODE_VERSION = "20"
  NPM_VERSION = "10"
  NETLIFY = "true"  # DÃ©sactive PWA sur Netlify
  NETLIFY_NEXT_SKEW_PROTECTION = "true"  # Protection contre les dÃ©calages client/serveur lors des dÃ©ploiements

# ==============================================================================
# VARIABLES D'ENVIRONNEMENT Ã€ CONFIGURER DANS L'UI NETLIFY
# Site settings > Environment variables
# ==============================================================================
#
# ğŸ”´ REQUISES:
#   - NEXT_PUBLIC_SUPABASE_URL
#   - NEXT_PUBLIC_SUPABASE_ANON_KEY
#   - SUPABASE_SERVICE_ROLE_KEY (ğŸ”’ secret)
#   - API_KEY_MASTER_KEY (ğŸ”’ secret)
#   - NEXT_PUBLIC_APP_URL (ex: https://votre-site.netlify.app)
#
# ğŸŸ¡ OPTIONNELLES (selon fonctionnalitÃ©s activÃ©es):
#   - OPENAI_API_KEY (ğŸ”’ secret) - pour les fonctionnalitÃ©s IA
#   - STRIPE_SECRET_KEY (ğŸ”’ secret) - pour les paiements
#   - NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY - pour les paiements
#   - RESEND_API_KEY (ğŸ”’ secret) - pour les emails
#   - TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN (ğŸ”’ secrets) - pour les SMS
#   - NEXT_PUBLIC_SENTRY_DSN - pour le monitoring
#   - NEXT_PUBLIC_POSTHOG_KEY - pour les analytics
#
# âš ï¸  IMPORTANT: Les variables marquÃ©es ğŸ”’ sont secrÃ¨tes et ne doivent
#     JAMAIS commencer par NEXT_PUBLIC_ pour Ã©viter l'exposition au client.
# ==============================================================================

# Headers de sÃ©curitÃ©
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "camera=(), microphone=(), geolocation=()"
    Strict-Transport-Security = "max-age=31536000; includeSubDomains"

# Headers spÃ©cifiques pour les assets statiques (cache long)
[[headers]]
  for = "/_next/static/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Redirections (optimisation: plus rapide que le middleware)
[[redirects]]
  from = "/app/*"
  to = "/:splat"
  status = 301
  force = true

[[redirects]]
  from = "/tenant/home"
  to = "/tenant/dashboard"
  status = 301

# Note: Les autres redirections sont gÃ©rÃ©es par le plugin Next.js

